(function(){var t,n,e,i,r={}.hasOwnProperty,o=[].slice;t={LF:"\n",NULL:"\0"},e=function(){var n;function e(t,n,e){this.command=t,this.headers=null!=n?n:{},this.body=null!=e?e:""}return e.prototype.toString=function(){var n,i,o,s;n=[this.command],s=this.headers;for(i in s)r.call(s,i)&&(o=s[i],n.push(i+":"+o));return this.body&&n.push("content-length:"+e.sizeOfUTF8(this.body)),n.push(t.LF+this.body),n.join(t.LF)},e.sizeOfUTF8=function(t){return t?encodeURI(t).split(/%..|./).length-1:0},n=function(n){var i,r,o,s,u,a,c,h,f,p,d,l,b,g,v,m,y;for(s=n.search(RegExp(""+t.LF+t.LF)),o=(u=n.substring(0,s).split(t.LF)).shift(),a={},l=function(t){return t.replace(/^\s+|\s+$/g,"")},b=0,v=(m=u.reverse()).length;b<v;b++)h=(p=m[b]).indexOf(":"),a[l(p.substring(0,h))]=l(p.substring(h+1));if(i="",d=s+2,a["content-length"])f=parseInt(a["content-length"]),i=(""+n).substring(d,d+f);else for(r=null,c=g=d,y=n.length;(d<=y?g<y:g>y)&&(r=n.charAt(c))!==t.NULL;c=d<=y?++g:--g)i+=r;return new e(o,a,i)},e.unmarshall=function(e){var i;return function(){var r,o,s,u;for(u=[],r=0,o=(s=e.split(RegExp(""+t.NULL+t.LF+"*"))).length;r<o;r++)(null!=(i=s[r])?i.length:void 0)>0&&u.push(n(i));return u}()},e.marshall=function(n,i,r){return new e(n,i,r).toString()+t.NULL},e}(),n=function(){var n;function r(t){this.ws=t,this.ws.binaryType="arraybuffer",this.counter=0,this.connected=!1,this.heartbeat={outgoing:1e4,incoming:1e4},this.maxWebSocketFrameSize=16384,this.subscriptions={}}return r.prototype.debug=function(t){var n;return"undefined"!=typeof window&&null!==window&&null!=(n=window.console)?n.log(t):void 0},n=function(){return Date.now||(new Date).valueOf},r.prototype._transmit=function(t,n,i){var r;for(r=e.marshall(t,n,i),"function"==typeof this.debug&&this.debug(">>> "+r);;){if(!(r.length>this.maxWebSocketFrameSize))return this.ws.send(r);this.ws.send(r.substring(0,this.maxWebSocketFrameSize)),r=r.substring(this.maxWebSocketFrameSize),"function"==typeof this.debug&&this.debug("remaining = "+r.length)}},r.prototype._setupHeartbeat=function(e){var r,o,s,u,a,c,h,f;if((a=e.version)===i.VERSIONS.V1_1||a===i.VERSIONS.V1_2)return o=(c=function(){var t,n,i,r;for(r=[],t=0,n=(i=e["heart-beat"].split(",")).length;t<n;t++)u=i[t],r.push(parseInt(u));return r}())[0],r=c[1],0!==this.heartbeat.outgoing&&0!==r&&(s=Math.max(this.heartbeat.outgoing,r),"function"==typeof this.debug&&this.debug("send PING every "+s+"ms"),this.pinger=i.setInterval(s,(h=this,function(){return h.ws.send(t.LF),"function"==typeof h.debug?h.debug(">>> PING"):void 0}))),0!==this.heartbeat.incoming&&0!==o?(s=Math.max(this.heartbeat.incoming,o),"function"==typeof this.debug&&this.debug("check PONG every "+s+"ms"),this.ponger=i.setInterval(s,(f=this,function(){var t;if((t=n()-f.serverActivity)>2*s)return"function"==typeof f.debug&&f.debug("did not receive server activity for the last "+t+"ms"),f.ws.close()}))):void 0},r.prototype._parseConnect=function(){var t,n,e,i;switch(i={},(t=1<=arguments.length?o.call(arguments,0):[]).length){case 2:i=t[0],n=t[1];break;case 3:t[1]instanceof Function?(i=t[0],n=t[1],e=t[2]):(i.login=t[0],i.passcode=t[1],n=t[2]);break;case 4:i.login=t[0],i.passcode=t[1],n=t[2],e=t[3];break;default:i.login=t[0],i.passcode=t[1],n=t[2],e=t[3],i.host=t[4]}return[i,n,e]},r.prototype.connect=function(){var r,s,u,a,c,h,f;return r=1<=arguments.length?o.call(arguments,0):[],a=this._parseConnect.apply(this,r),u=a[0],this.connectCallback=a[1],s=a[2],"function"==typeof this.debug&&this.debug("Opening Web Socket..."),this.ws.onmessage=(c=this,function(i){var r,o,u,a,h,f,p,d,l,b,g,v;if(a="undefined"!=typeof ArrayBuffer&&i.data instanceof ArrayBuffer?(r=new Uint8Array(i.data),"function"==typeof c.debug&&c.debug("--- got data length: "+r.length),function(){var t,n,e;for(e=[],t=0,n=r.length;t<n;t++)o=r[t],e.push(String.fromCharCode(o));return e}().join("")):i.data,c.serverActivity=n(),a!==t.LF){for("function"==typeof c.debug&&c.debug("<<< "+a),v=[],l=0,b=(g=e.unmarshall(a)).length;l<b;l++)switch((h=g[l]).command){case"CONNECTED":"function"==typeof c.debug&&c.debug("connected to server "+h.headers.server),c.connected=!0,c._setupHeartbeat(h.headers),v.push("function"==typeof c.connectCallback?c.connectCallback(h):void 0);break;case"MESSAGE":d=h.headers.subscription,(p=c.subscriptions[d]||c.onreceive)?(u=c,f=h.headers["message-id"],h.ack=function(t){return null==t&&(t={}),u.ack(f,d,t)},h.nack=function(t){return null==t&&(t={}),u.nack(f,d,t)},v.push(p(h))):v.push("function"==typeof c.debug?c.debug("Unhandled received MESSAGE: "+h):void 0);break;case"RECEIPT":v.push("function"==typeof c.onreceipt?c.onreceipt(h):void 0);break;case"ERROR":v.push("function"==typeof s?s(h):void 0);break;default:v.push("function"==typeof c.debug?c.debug("Unhandled frame: "+h):void 0)}return v}"function"==typeof c.debug&&c.debug("<<< PONG")}),this.ws.onclose=(h=this,function(){var t;return t="Whoops! Lost connection to "+h.ws.url,"function"==typeof h.debug&&h.debug(t),h._cleanUp(),"function"==typeof s?s(t):void 0}),this.ws.onopen=(f=this,function(){return"function"==typeof f.debug&&f.debug("Web Socket Opened..."),u["accept-version"]=i.VERSIONS.supportedVersions(),u["heart-beat"]=[f.heartbeat.outgoing,f.heartbeat.incoming].join(","),f._transmit("CONNECT",u)})},r.prototype.disconnect=function(t){return this._transmit("DISCONNECT"),this.ws.onclose=null,this.ws.close(),this._cleanUp(),"function"==typeof t?t():void 0},r.prototype._cleanUp=function(){if(this.connected=!1,this.pinger&&i.clearInterval(this.pinger),this.ponger)return i.clearInterval(this.ponger)},r.prototype.send=function(t,n,e){return null==n&&(n={}),null==e&&(e=""),n.destination=t,this._transmit("SEND",n,e)},r.prototype.subscribe=function(t,n,e){var i;return null==e&&(e={}),e.id||(e.id="sub-"+this.counter++),e.destination=t,this.subscriptions[e.id]=n,this._transmit("SUBSCRIBE",e),i=this,{id:e.id,unsubscribe:function(){return i.unsubscribe(e.id)}}},r.prototype.unsubscribe=function(t){return delete this.subscriptions[t],this._transmit("UNSUBSCRIBE",{id:t})},r.prototype.begin=function(t){var n,e;return e=t||"tx-"+this.counter++,this._transmit("BEGIN",{transaction:e}),n=this,{id:e,commit:function(){return n.commit(e)},abort:function(){return n.abort(e)}}},r.prototype.commit=function(t){return this._transmit("COMMIT",{transaction:t})},r.prototype.abort=function(t){return this._transmit("ABORT",{transaction:t})},r.prototype.ack=function(t,n,e){return null==e&&(e={}),e["message-id"]=t,e.subscription=n,this._transmit("ACK",e)},r.prototype.nack=function(t,n,e){return null==e&&(e={}),e["message-id"]=t,e.subscription=n,this._transmit("NACK",e)},r}(),i={VERSIONS:{V1_0:"1.0",V1_1:"1.1",V1_2:"1.2",supportedVersions:function(){return"1.1,1.0"}},client:function(t,e){var r;return null==e&&(e=["v10.stomp","v11.stomp"]),r=new(i.WebSocketClass||WebSocket)(t,e),new n(r)},over:function(t){return new n(t)},Frame:e},"undefined"!=typeof window&&null!==window?(i.setInterval=function(t,n){return window.setInterval(n,t)},i.clearInterval=function(t){return window.clearInterval(t)},window.Stomp=i):"undefined"!=typeof exports&&null!==exports?exports.Stomp=i:self.Stomp=i}).call(this);